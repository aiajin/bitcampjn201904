<!DOCTYPE html>
<html lang="en">
 
<head>
    <meta charset="UTF-8">
    <title>Document</title>
 
    <script src="https://code.jquery.com/jquery-1.10.0.js"></script>
 
    <script>
        //빈 배열 생성
          var members = [];
        //null의 값이 아닐때만 저장소에 'arr'이라고 저장되어있는 정보를 배열에 저장함
        //만약 빈배열에 null을 넣으면 자동형변환되서 배열이 아닌 null이 되는듯함.
        //그래서 null일때 넣어주면 members는 더이상 배열이 아님으로 push, lenght와 같은
        //배열관련 메서드를 사용할수 없음
       if (JSON.parse(localStorage.getItem('arr') != null)) {  
            members = JSON.parse(localStorage.getItem('arr'));
        }   
        
       
        //Member라는 생성자 선언
     function Member(id, pwd, name) {
            this.id = id;
            this.pwd = pwd;
            this.name = name;
        }
 
        $(document).ready(function() {
            
            //등록버튼 클릭시 이벤트 발생
            $('#submitt').on('click',function(){
               
                // 입력값 id,pw,name을 가져옴
                var idvalue = $('#id');
                var pwdvalue = $('#pwd');
                var namevalue = $('#namee');
                var cnt = members.length;
                // id,pw,name에 값이 있을때만 실행
                if (idvalue.val() != "" && pwdvalue.val() != "" && namevalue.val() != "") {
                    //입력값을 Member라는 생성자로 member 객체 생성
                    var member = new Member(idvalue.val(), pwdvalue.val(), namevalue.val());
                    //배열에 추가
                    members.push(member);
                    //갱신된 내용을 저장소에 JSON형식의 String값으로 저장해줌
                    localStorage.setItem('arr', JSON.stringify(members));
 
                    //table에 추가 수정은 midifyy(cnt,this), 삭제는removee(cnt))함수 선언  
                    $('#board').append( '<tr id=\"' + cnt + '\"><td>' + cnt + '</td><td>' + member.id + '</td><td>' + member.pwd + '</td><td>' + member.name + '</td><td> <button id=\"' + cnt + '\" onclick=\"modifyy(' + cnt + ')\">수정</button> <button onclick="removee(' + cnt + ')">삭제</button></td></tr>');
                    
                    //입력값 삭제 
                    $('#err').html('');
                    namevalue.val('');
                    pwdvalue.val('');
                    idvalue.val('');
                } else {
                    //id,pw,name에 하나라고 값이 없을시 안내 p태그
                    $('#err').html('값을 제대로 입력하세요!') ;
 
                } 
                
            });
        });
      
        //삭제
        function removee(index) {
            //삭제시 confirm을 통해 확인버튼 true일때만 동작
            if (confirm('정말 삭제 하시겠습니까?')) {
                //splice 메서드를 통해 버튼의 index에 해당하는 배열 삭제
                members.splice(index, 1);
                //갱신된 내용을 저장소에 JSON형식의 String값으로 저장해줌
                localStorage.setItem('arr', JSON.stringify(members));
                //달라진 index값을 정리 하기 위해 table을 다시 만들어주는 함수 table()을 실행
                table();
            }
        }
 
        //수정
        function modifyy(index) {
            //수정 버튼 누를시 숨겨있던 수정창을 보이게함
            $('#modifyDiv').css('visibility','visible');
            
            //배열 members에서 해당 index에 있는 Member객체를 member변수에 입력
            var member = members[index];
            
            //수정창에 수정하려는 객체의 id,pwd,name값을 넣어줌
            $('#modiid').val(member.id);
            $('#modipwd').val(member.pwd);
            $('#modiname').val(member.name);
            //인덱스를 수정확인 버튼에 value값으로 저장해줌 
            $('#real').val(index);
        }
 
        //수정 확인
        function realmodi() {
            //배열에서 index(버튼의 value값)에 해당하는 member객체 저장
            var member = members[$('#real').val()];
           // 맴버 객체에 각 수정된 값(value)로 바꿈
            member.id = $('#modiid').val();
            member.pwd = $('#modipwd').val();
            member.name = $('#modiname').val();
            
            //수정된 member객체를 같은위치의 index(버튼의 value값)에 저장함 
            members[$('#real').value] = member;
            //갱신된 내용을 저장소에 JSON형식의 String값으로 저장해줌
            localStorage.setItem('arr', JSON.stringify(members));
            //수정창 다시 숨김
            $('#modifyDiv').css('visibility','hidden');
            
          //달라진 값을 정리 하기 위해 table을 다시 만들어주는 함수 table()을 실행
            table();
        }
    </script>
 
 
 
    <style>
        .padd {
            padding-left: 10px;
        }
        .inputA {
            width: 180px;
            height: 35px;
        }
        .buttonA {
            width: 150px;
            height: 40px;
            padding-left: 10px;
            background-color: black;
            color: white;
            font-size: 1.2em;
        }
        #header {
            border-top: 2px solid lightgray;
            border-bottom: 2px solid lightgray;
        }
        .board {
            width: 100%;
        }
        #board td {
            text-align: center;
            border: 1px solid black;
        }
        #real {
            margin: auto;
        }
        .center {
            text-align: center
        }
        #modifyDiv {
            visibility: hidden;
            position: fixed;
            top: 0;
            right: 0;
            padding-top: 10px;
            width: 270px;
            background-color: aliceblue;
        }
        #modifyDiv table {
            border-top: 1px solid gray;
        }
        #modifyDiv h3 {
            text-align: center;
        }
    </style>
 
 
</head>
 
<body>
    <h1>Member Manager</h1>
    <div id="header">
        <form id="sign">
            <h3>회원등록</h3>
            <table>
                <tr>
                    <td class="padd">아이디(이메일)</td>
                    <td class="padd">비밀번호</td>
                    <td class="padd">이름</td>
                    <td class="padd" rowspan="2"><input class="buttonA" id="submitt" type="button" value="등록"></td>
                </tr>
                <tr>
                    <td><input id="id" class="inputA" type="text"></td>
                    <td><input id="pwd" class="inputA" type="password"></td>
                    <td><input id="namee" class="inputA" type="name"></td>
                </tr>
            </table>
        </form>
    </div>
    <p id="err"></p>
 
    <div>
        <h3>회원리스트</h3>
        <table class="board">
            <tbody id="board">
                <tr>
                    <td>index</td>
                    <td>아이디(이메일)</td>
                    <td>비밀번호</td>
                    <td>이름</td>
                    <td>관리</td>
                </tr>
 
 
            </tbody>
        </table>
 
    </div>
    <div id="modifyDiv">
        <h3>데이터수정</h3>
        <table>
            <tr>
                <td>
                    아이디(이메일) </td>
                <td><input class="inputA" id="modiid" type="text">
                </td>
            </tr>
            <tr>
                <td>
                    비밀번호</td>
                <td><input class="inputA" id="modipwd" type="password"></td>
            </tr>
            <tr>
                <td> 이름 </td>
                <td><input class="inputA" id="modiname" type="text"></td>
            </tr>
            <tr>
                <td class="center" colspan="2"><button id="real" class="buttonA" onclick="realmodi()" >눌러</button></td>
            </tr>
        </table>
    </div>
    <script>
        //boardInitial이라는 변수에 tbody의 초기 테이블값을 저장함
        var boardInitial = $('#board').html();
 
        //테이블 갱신 함수
        function table() {
            //테이블을 테이블 초기값으로 초기화 
            $('#board').html(boardInitial);
            //null이 아닐시에 아래 for문 진행
            if (localStorage.getItem('arr') != null) {
                       //테이블을 새로 그려줌
                $.each(members,function(index,item){
                    var str = '<tr id=\"' + index + '\"><td>' + index + '</td><td>' + item.id + '</td><td>' + item.pwd + '</td><td>' + item.name + '</td><td> <button onclick=\"modifyy(' + index + ')\">수정</button> <button onclick="removee(' + index + ')">삭제</button></td></tr>' 
                    $('#board').append(str);  
                });
         
            }
 
        }     
        //처음 새로고침시 테이블 생성 함수 실행
        table();
 
    </script>
</body>
 
</html>